<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- CSS -->

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <!-- Font Awesome CSS Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"
    />
    <!-- My stylesheets -->
    <link rel="stylesheet" type="text/css" href="assets/css/reset.css" />
    <link rel="stylesheet" type="text/css" href="assets/css/style.css" />

    <!-- jQuery JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <!-- My JavaScript -->
    <script src="assets/js/script.js"></script>

    <title>Note Taker üìù</title>
  </head>

  <body>
    <nav class="navbar bg-warning justify-content-center">
      <a class="navbar-brand" href="/">
        <span class="display-3 text-white">üìù Note Taker</span>
      </a>
    </nav>

    <div class="container mx-md-0 mb-5">
      <div class="row">
        <!--------------- Side Bar ---------->
        <div class="container col-md-3 bg-light px-0">
          <nav class="nav flex-column h1">
            <a class="nav-link text-dark y border" id="addNote" href="#"
              >Add Note <i class="far fa-edit"></i
            ></a>
            <a class="nav-link text-dark y border" href="/notes"
              >My Notes <i class="far fa-clipboard"></i
            ></a>
          </nav>
        </div>
        <!--------------- End Side Bar ---------->
        <!--------------- Start Form -------------------->
        <div class="container col-md-9" id="form">
          <form class="my-0">
            <div class="row my-4">
              <div class="col-12 display-4">Add Note</div>
            </div>

            <div class="form-group h2 my-0">
              <label for="formGroupExampleInput" class="col-12 py-2 y"
                ><i class="fas fa-heading"></i> Title</label
              >
              <textarea
                type="text"
                class="form-control"
                rows="1"
                id="title"
                placeholder="My Title"
              ></textarea>
            </div>
            <div class="form-group h2 my-0">
              <label for="formGroupExampleInput2" class="col-12 py-2 y"
                ><i class="fas fa-align-left"></i> Content</label
              >
              <textarea
                type="text"
                class="form-control"
                rows="10"
                id="content"
                placeholder="Ex: To-Do, Shopping, Important Dates..."
              ></textarea>
              <button
                type="button"
                class="btn btn-warning w-100 text-white"
                id="submitNote"
                data-toggle="modal"
                data-target="#noteAddedModal"
              >
                Add Note <i class="far fa-plus-square"></i>
              </button>
            </div>
          </form>

          <!-- Note Added Modal -->
          <div
            class="modal fade"
            id="noteAddedModal"
            tabindex="-1"
            role="dialog"
            aria-labelledby="exampleModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Note Added</h5>
                  <button
                    type="button"
                    class="close"
                    data-dismiss="modal"
                    aria-label="Close"
                  >
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">Your notes have been updated</div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-dismiss="modal"
                    onclick="window.location.href='/notes'"
                  >
                    See Notes
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-dismiss="modal"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- End Modal-->
        </div>

        <!----------------- End Form ----------------->

        <!------------------------- Start Single Note Display ------------------------->

        <div class="container col-md-9" id="note">
          <form class="my-0" id="form">
            <div class="row my-4">
              <div class="col-12 display-4" id="noteID">Note</div>
            </div>

            <div class="form-group h2 my-0">
              <label for="formGroupExampleInput" class="col-12 py-2 y"
                ><i class="fas fa-heading"></i> Title</label
              >
              <textarea
                type="text"
                class="form-control"
                rows="1"
                id="noteTitle"
              ></textarea>
            </div>
            <div class="form-group h2 my-0">
              <label for="formGroupExampleInput2" class="col-12 py-2 y"
                ><i class="fas fa-align-left"></i> Content</label
              >
              <textarea
                type="text"
                class="form-control"
                rows="10"
                id="noteContent"
              ></textarea>
              <button
                type="button"
                class="btn btn-warning w-100 text-white"
                id="updateNote"
                data-toggle="modal"
                data-target="#noteUpdatedModal"
              >
                Update Note <i class="fas fa-sync"></i>
              </button>
            </div>

            <!-- Note Updated Modal -->
            <div
              class="modal fade"
              id="noteUpdatedModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                      Note Updated
                    </h5>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">Your notes have been updated</div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-dismiss="modal"
                      onclick="window.location.href='/notes'"
                    >
                      See Notes
                    </button>
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- End Modal -->
          </form>
        </div>

        <!------------------------- End Single Note Display ------------------------->

        <!-- Notes rendered here vv -->
        <div class="container col-md-9" id="notes"></div>
      </div>
    </div>

    <script>
      //Clears the notes from the webpage. Displays the form to add a note.
      $("#addNote").on("click", function (e) {
        $("#notes").empty();
        $("#form").css("display", "block");
        $("#note").css("display", "none");
      });

      //When the user clicks a note to see details. Clears all notes from the webpage.
      //Hides the form to add a note
      //Displays the form that allows to see and edit a note. Gets note information from server
      $(document).on("click", ".list-group-item", function (e) {
        $("#notes").empty();
        $("#form").css("display", "none");
        $("#note").css("display", "block");
        //Gets the note id
        var id = parseInt($(this).attr("data-id"));
        $("#noteID").empty();
        $("#noteID").append("Note " + id);
        //uses note id to query the server on that id
        $.get(`/api/notes/${id}`, function (data) {
          //updates web elements
          $("#noteTitle").val(data.title);
          $("#noteContent").val(data.body);
        });
      });

      //Sends new note information to the server
      $("#submitNote").on("click", function (e) {
        event.preventDefault();
        var newNote = {
          id: -1,
          title: $("#title").val().trim(),
          body: $("#content").val().trim(),
        };

        $.post("/api/notes/", newNote).then(function (data) {
          let file = fs.readFileSync("data/db.json");
          let content = JSON.parse(data);
          console.log(data);
          res.json(content);
        });
      });

      //sends updated note information to server
      $("#updateNote").on("click", function (e) {
        event.preventDefault();
        var updatedNote = {
          id: parseInt($("#noteID").text().substring(5)),
          title: $("#noteTitle").val().trim(),
          body: $("#noteContent").val().trim(),
        };

        $.post("/api/notes/", updatedNote).then(function (data) {
          console.log(data);
        });
      });

      //Gets all notes from server
      //Loops through every note and created DOM elements to display note cards on the webpage
      function renderNotes() {
        // $("#form").css("display", "none");
        // $("#note").css("display", "none");

        $.get("/api/notes", function (data) {
          for (var i = 0; i < data.length; i++) {
            console.log(data[i]);
            var row = $('<div class="row">');
            var col = $('<div class="col-12">');
            var listGroupItem = $("<li class='list-group-item'>");
            listGroupItem.attr("data-id", data[i].id);
            var button = $('<button class="btn float-right del">');
            button.attr("data-id", data[i].id);
            button.text("X");
            if (i % 2 === 0) {
              listGroupItem.addClass("y");
              button.addClass("bg-white");
            } else {
              button.addClass("y");
            }
            listGroupItem.append(button);
            listGroupItem.append(
              $("<h2 class='h2'>").text("Note ID: " + data[i].id)
            );
            listGroupItem.append(
              $("<h2 class='h2'>").text("Title:  " + data[i].title)
            );
            col.append(listGroupItem);
            row.append(col);

            if (i === 0) {
              var tRow = $('<div class="row my-4">');
              var tCol = $('<div class="col-12 display-4">');
              tCol.text("My Notes");
              tRow.append(tCol);
              $("#notes").append(tRow);
            }

            $("#notes").append(row);
          }
        });
      }

      //Sends id of note to be deleted to the server
      $(document).on("click", ".del", function (event) {
        $.ajax({
          url: `/api/notes/${$(this).attr("data-id")}`,
          method: "DELETE",
        }).then(function () {
          $("#notes").empty();
          renderNotes();
        });
      });

      //Render notes when directed to this page
      $(document).ready(function () {
        renderNotes();
      });
    </script>

    <!-- jQuery JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <!-- My JavaScript -->
    <script src="assets/js/script.js"></script>
  </body>
</html>
